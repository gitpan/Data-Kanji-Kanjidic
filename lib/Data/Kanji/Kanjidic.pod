=encoding UTF-8

=head1 NAME

Data::Kanji::Kanjidic - parse the "kanjidic" kanji data file

=head1 SYNOPSIS

    use Data::Kanji::Kanjidic 'parse_kanjidic';
    my $kanji = parse_kanjidic ('/path/to/kanjidic');
    for my $k (keys %$kanji) {
        print "$k has radical number $kanji->{C}.\n";
    }


=head1 FUNCTIONS

=head2 parse_kanjidic

    my $kanjidic = parse_kanjidic ('kanjidic');

The input is the name of the file. The output is a hash reference. The
keys of the hash reference are kanji, encoded as Unicode. The values
of the hash reference are entries corresponding to the kanji in the
keys. Each value represents one line of Kanjidic. Each is a hash
reference, with the keys described in L</parse_entry>.

This function assumes that the kanjidic file is encoded using the
EUC-JP encoding.

=head2 parse_entry

    my %values = parse_entry ($line);

Parse one line of F<kanjidic>.

The possible keys and values of the returned hash are as
follows. Values are scalars unless otherwise mentioned.

=over

=item kanji

The kanji itself (the same as the key).



=item B

Bushu (radical as defined by the Nelson kanji dictionary)

=item C

Classic radical (the usual radical)

=item DB

Japanese for Busy People textbook numbers

=item DC

The index numbers used in "The Kanji Way to Japanese Language Power" by Dale Crowley.

=item DF

"Japanese Kanji Flashcards", by Max Hodges and Tomoko Okazaki

=item DG

The index numbers used in the "Kodansha Compact Kanji Guide"

=item DH

The index numbers used in the 3rd edition of "A Guide To Reading and Writing Japanese" edited by Kenneth Hensall et al.

=item DJ

The index numbers used in the "Kanji in Context" by Nishiguchi and Kono.

=item DK

The index numbers used by Jack Halpern in his Kanji Learners Dictionary

=item DM

The index numbers from the French-language version of "Remembering the kanji"

=item DO

The index numbers used in P.G. O'Neill's Essential Kanji

=item DR

the codes developed by Father Joseph De Roo, and published in his book "2001 Kanji" (Bonjinsha)

=item DS

The index numbers used in the early editions of "A Guide To Reading and Writing Japanese" edited by Florence Sakade.

=item DT

The index numbers used in the Tuttle Kanji Cards, compiled by Alexander Kask.

=item E

The numbers used in Kenneth Henshall's kanji book

=item F

Frequency of kanji
This prints a list of kanji from most frequent to least.

    
    use Data::Kanji::Kanjidic 'parse_kanjidic';
    my $kanji = parse_kanjidic ('/path/to/kanjidic');
    my @sorted;
    for my $k (keys %$kanji) {
        if ($kanji->{$k}->{F}) {
            push @sorted, $kanji->{$k};
        }
    }
    @sorted = sort {$a->{F} <=> $b->{F}} @sorted;
    binmode STDOUT, ":utf8";
    for (@sorted) {
        print "$_->{kanji}: $_->{F}\n";
    }
    


=item G

Year of elementary school

=item H

Number in Jack Halpern dictionary

=item I

The Spahn-Hadamitzky book number

=item IN

The Spahn-Hadamitzky kanji-kana book number

=item J

Japanese proficiency test level of the kanji

=item K

The index in the Gakken Kanji Dictionary (A New Dictionary of Kanji Usage);

=item L

Code from "Remembering the Kanji" by James Heisig

=item MN

Morohashi index number

=item MP

Morohashi volume/page

=item N

Nelson code from original Nelson dictionary

=item O

The numbers used in P.G. O'Neill's "Japanese Names"
This may take multiple values, so the value is an array reference.

=item P

SKIP code

=item Q

Four-corner code for the kanji
This may take multiple values, so the value is an array reference.

=item S

Stroke count
This may take multiple values, so the value is an array reference.

=item T

SPECIAL

=item U

Unicode

=item V

Nelson code from the "New Nelson" dictionary
This may take multiple values, so the value is an array reference.

=item W

Korean pronunciation
This may take multiple values, so the value is an array reference. 

This prints a list of Korean pronunciations, romanized (requires
L<Lingua::KO::Munja>).

    use Data::Kanji::Kanjidic 'parse_kanjidic';
    use Lingua::KO::Munja ':all'; # 강남스타일
    binmode STDOUT, ":utf8";
    my $kanji = parse_kanjidic ($ARGV[0]);
    for my $k (sort keys %$kanji) {
        my $w = $kanji->{$k}->{W};
        if ($w) {
            my @h = map {'"' . hangul2roman ($_) . '"'} @$w;
            print "$k is Korean ", join (", ", @h), "\n";
        }
    }


=item X

Cross reference

=item XDR

De Roo cross-reference
This may take multiple values, so the value is an array reference.

=item XH

Cross-reference.
This may take multiple values, so the value is an array reference.

=item XI

Cross-reference.

=item XJ

Cross-reference.
This may take multiple values, so the value is an array reference.

=item XN

Nelson cross-reference
This may take multiple values, so the value is an array reference.

=item XO

Cross-reference.

=item Y

Pinyin pronunciation
This may take multiple values, so the value is an array reference.

=item ZBP

MISCLASSIFICATIONrp
This may take multiple values, so the value is an array reference.

=item ZPP

MISCLASSIFICATIONpp
This may take multiple values, so the value is an array reference.

=item ZRP

MISCLASSIFICATIONrp
This may take multiple values, so the value is an array reference.

=item ZSP

MISCLASSIFICATIONsp
This may take multiple values, so the value is an array reference.
=item kokuji

This has a true value (1) if the character is marked as a "kokuji" in
Kanjidic.

=item english

This contains an array reference to the English-language meanings
given in Kanjidic. It may be undefined, if there are no
English-language meanings listed.

    # The following insane program converts English into kanji.
    
    # Call it like "english-to-kanji.pl /where/is/kanjidic english-text".
    
    use Data::Kanji::Kanjidic 'parse_kanjidic';
    use Convert::Moji 'make_regex';
    my $kanji = parse_kanjidic ($ARGV[0]);
    my %english;
    for my $k (keys %$kanji) {
        my $english = $kanji->{$k}->{english};
        if ($english) {
            for (@$english) {
                push @{$english{$_}}, $k;
            }
        }
    }
    my $re = make_regex (keys %english);
    open my $in, "<", $ARGV[1] or die $!;
    while (<$in>) {
        s/\b($re)\b/$english{$1}[int rand (@{$english{$1}})]/ge;
        print;
    }
    


=item onyomi

This is an array reference which contains the I<on'yomi> (音読) of the
kanji. It may be undefined, if no I<on'yomi> readings are listed. The
I<on'yomi> readings are in katakana, as per Kanjidic itself. It is
encoded in Perl's internal Unicode encoding.

The following example prints a list of kanji which have the same on'yomi:

    binmode STDOUT, ":utf8";
    use Data::Kanji::Kanjidic 'parse_kanjidic';
    my $kanji = parse_kanjidic ($ARGV[0]);
    my %all_onyomi;
    for my $k (keys %$kanji) {
        my $onyomi = $kanji->{$k}->{onyomi};
        if ($onyomi) {
            for my $o (@$onyomi) {
                push @{$all_onyomi{$o}}, $k;
            }
        }
    }
    for my $o (sort keys %all_onyomi) {
        if (@{$all_onyomi{$o}} > 1) {
            print "Same onyomi 「$o」 for 「@{$all_onyomi{$o}}」!\n";
        }
    }


=item kunyomi

This is an array reference which contains the I<kun'yomi> (訓読) of
the kanji. It may be undefined, if no I<kun'yomi> readings are
listed. The I<kun'yomi> readings are in hiragana, as per Kanjidic
itself. It is encoded in Perl's internal Unicode encoding.

=item nanori

This is an array reference which contains I<nanori> (名乗り) readings
of the character. It may be undefined, if no I<nanori> readings are
listed. The I<nanori> readings are in hiragana, as per Kanjidic
itself. They are encoded in Perl's internal Unicode encoding.

=item morohashi

This is a hash reference containing data on the kanji's location in
the Morohashi 'Dai Kan-Wa Jiten' kanji dictionary. The hash reference
has the following keys.

=over

=item volume

The volume number of the character.

=item page

The page number of the character.

=item index

The index number of the character.

=back

If there is no information, this remains unset.

For example, to print all the existing values,

    
    use Data::Kanji::Kanjidic 'parse_kanjidic';
    use FindBin;
    binmode STDOUT, ":utf8";
    my $kanji = parse_kanjidic ("/path/to/kanjidic");
    for my $k (sort keys %$kanji) {
        my $mo = $kanji->{$k}->{morohashi};
        if ($mo) {
            print "$k: volume $mo->{volume}, page $mo->{page}, index $mo->{index}.\n";
        }
    }
    


=back

For detailed explanations of these codes, see L</Kanjidic>.

=head2 kanjidic_order

    kanjidic_order ($kanjidic_ref);

Return a list sorted by stroke order of the elements of
C<\%kanjidic>. Also add the field "kanji_id" to each of them so that
the order can be reconstructed when referring to elements.

=head1 SEE ALSO

=head2 Other Perl modules

=over

=item L<Lingua::JP::Kanjidic>

This module parses an old version of F<kanjidic>.

=back

=head2 Kanjidic

The official description of kanjidic is in
L<http://www.csse.monash.edu.au/~jwb/kanjidic.html>.  To download
F<kanjidic>, please go to this web page and then download it from the
link provided.

=head1 AUTHOR

Ben Bullock, <bkb@cpan.org>

=head1 COPYRIGHT & LICENCE

This package and associated files are copyright (C) 2012-2013 Ben
Bullock.

You can use, copy, modify and redistribute this package and associated
files under the Perl Artistic Licence or the GNU General Public
Licence.


